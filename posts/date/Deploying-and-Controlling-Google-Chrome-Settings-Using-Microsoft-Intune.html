<!doctype html>
<html lang="en"> <head> <title>Life Inside a Computer</title> <meta http-equiv="content-type" content="text/html;" charset="UTF-8" /> <meta name="viewport" content="width=device-width, initial-scale=1"> <link href="https://sporiff.github.io/css/style.min.css" rel="stylesheet" type="text/css" /> <link rel="alternate" href="https://sporiff.github.io/rss.xml" type="application/rss+xml" /> <link rel="icon" type="image/png" href="https://sporiff.github.io/css/favicon.png" /> <meta name="flattr:id" content="d7zprl"> <meta property="twitter:card" content="summary" />
<meta property="twitter:author" content="@thatdapperbrit" />
<meta property="twitter:title" content="Deploying and Controlling Google Chrome Settings Using Microsoft Intune" />
<meta property="twitter:description" content="<p>Righto. This one has given me a mild headache for the last couple of days, but I've found a workable 
solution that allows me to set a home page for users in Chrome. You would have thought that wo" /> </head> <body> <nav class="navigation"> <a href="https://sporiff.github.io">Home</a> | <a href="mailto:ciaranainsworth@outlook.com">Email</a>  | <a href="https://github.com/Sporiff">Code</a>  | <a href="https://paypal.me/CiaranAinsworth">Support me</a>  | <a href="https://assets.rootkey.co.uk/static/resume.pdf">Resumé</a>  | <a href="https://sporiff.github.io/atom.xml">RSS</a>  </nav> <main id="content"> <section class="article-meta">
<h1 class="title">Deploying and Controlling Google Chrome Settings Using Microsoft Intune</h1>
<details open> <summary>Article Information</summary> <section class="tags">
Tagged as <a href="https://sporiff.github.io/tag/tech.html">tech</a>, <a href="https://sporiff.github.io/tag/microsoft.html">microsoft</a>, <a href="https://sporiff.github.io/tag/azure.html">azure</a>, <a href="https://sporiff.github.io/tag/chrome.html">chrome</a>, <a href="https://sporiff.github.io/tag/intune.html">intune</a> </section>
<section class="date">
Written on <time datetime="2018-07-27">2018-07-27</time> </section>
</section>
<article class="article-content">
<p>Righto. This one has given me a mild headache for the last couple of days, but I've found a workable 
solution that allows me to set a home page for users in Chrome. You would have thought that would be 
really easy, right? Well, Google in its infinite wisdom has decided that conventional Windows management 
is for wusses. So down the rabbit hole we go.</p>

<h2>Ingesting ADMX Templates</h2>

<p>Let us say, for the sake of argument, that you have deployed the Chrome Enterprise <code>.msi</code> to your devices 
either during a build or using Intune. Now you want to control some of the settings for your users in order 
to provide a consistent experience. If you look around online, you'll see various references to ingesting 
ADMX templates and leveraging these for using with Chrome. This looks something like this:</p>

<pre><code># Create an OMA-URI to import your ADMX template
* ./Device/Vendor/MSFT/Policy/ConfigOperations/ADMXInstall/Chrome/Policy/ChromeADMX}
* Data Type = String
* Value = the whole body of the Chrome ADMX template
# Leverage policies from within this template using nested OMA-URI settings
* ./Device/Vendor/MSFT/Policy/Config/Chrome~Policy~googlechrome/ShowHomeButton
* Data Type = String
* Value = &lt;enabled/&gt;</code></pre>

<p>Pretty simple stuff. This allows us to show the home button. Tickedy boo. So what about setting the home 
page and landing pages for users? Well, unfortunately, this isn't possible.</p>

<p>When you use the CSP settings to load and edit the GPO locally, Chrome detects that the computer is not 
connected to an on-prem AD, and will ignore certain settings including but not limited to your custom home 
page. Bum gravy. This is mentioned in some capacity in <a href="https://bugs.chromium.org/p/chromium/issues/detail?id=433112" >this thread</a>
 and in <a href="https://www.chromium.org/administrators/policy-list-3#HomepageLocation" >this advisory</a>, but it's far from a 
satisfactory explanation in an Azure AD connected world.</p>

<h2>What is a Boy to do?</h2>

<p>So here's the dilemma. I know that another way to control Chrome is using a file called <code>master_preferences</code> 
located in the <code>C:\Program Files (x86)\Google\Chrome\Application</code> folder, so for future deployments it would be 
entirely possible to simply place this in the image. However, we have nearly 60 devices already out in the world 
due to the unreal pressure we've been under to deliver, so I need a remote deployment method.</p>

<p>First option is to use Powershell. Powershell could easily be pointed at a publicly accessible Azure blob containing 
the <code>master_preferences</code> file. The problem with this is that Powershell scripts can only be targeted at users, 
which would mean that in the long run we would not be able to set different preferences on different types of machines.</p>

<p>So, what about a <code>.msi</code> file? I got this idea in my head to package the file up as an application, which would give 
us the power not only to deploy per device but also to supersede if we ever want to make changes to the config. 
The two tools I used to achieve this were <a href="http://nsis.sourceforge.net/Download" >NSIS</a> and the free version of 
<a href="https://www.exemsi.com/download/" >exemsi</a>. The steps are as follows:</p>

<ul>
<li>Edit your <code>master_preferences</code> file to reflect the changes you want to make</li>
<li>Place the file in a zip archive</li>
<li>Run NSIS and select &quot;Installer based on ZIP file&quot;</li>
<li>Select your ZIP file, give the installer a suitable name, and set the&quot;Default Folder&quot; value to <code>C:\Program Files (x86)\Google\Chrome\Application</code></li>
<li>Hit &quot;Generate&quot; and locate your newly created <code>.exe</code> file</li>
<li>Next, open up exemsi and click &quot;Next&quot; to start the wizard</li>
<li>Select your newly created executable and change the <code>.msi</code> name if desired</li>
<li>In the installer options, select &quot;Per Machine&quot; under &quot;MSI installation context&quot;. This is required to allow you to deploy to devices as opposed to users. If users are your targets, set this to &quot;Per User&quot;</li>
<li>Give your application and ID and generate an Upgrade Code. This will allow you to uninstall and supersede if needs be, so keep a note of it and use the same code for any new iterations. Intune will notify you if the codes do not match</li>
<li>Enter some information about the product including the name, the manufacturer, and the version number</li>
<li>Optionally, set up contact links</li>
<li>For install and uninstall arguments, use the flag &quot;/S&quot; (make sure this is capital). This is the standard NSIS silent install flag</li>
<li>There is no need to enter any before/after command lines</li>
<li>Hit &quot;Build&quot; at the end and it will generate a <code>.msi</code></li>
</ul>

<p>After this, upload your <code>.msi</code> to Intune, deploy it to a test group, and watch the magic happen. Please note that 
you cannot deploy the ADMX template and the <code>master_preferences</code> file at the same time as the two conflict with one another.</p>
 </article>
<nav class="relative-nav">
<a href="https://sporiff.github.io/posts/date/Microsoft-Teams-Deployment-Headaches.html">Previous</a><br>
<a href="https://sporiff.github.io/posts/date/New-Site.html">Next</a><br>
</nav>
 </main>  <footer class="fineprint"> Unless otherwise credited all material <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"> CC BY-SA 4.0 </a> by Ciarán Ainsworth </footer> </body> </html>