<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=stylesheet type=text/css href="/css/style.min.aae8ee50883b584313558270574543eede36d83be93537b1b82e3f25224db67a.css" integrity="sha256-qujuUIg7WEMTVYJwV0VD7t422DvpNTexuC4/JSJNtno="><link rel=stylesheet type=text/css href=/css/syntax-light.min.c3f7545ba2ec853ed9c45e1ac5856a1d2976599c771c238e3a8f73be8bb6a91b.css integrity="sha256-w/dUW6LshT7ZxF4axYVqHSl2WZx3HCOOOo9zvou2qRs=" media="screen and (prefers-color-scheme: light)"><link rel=stylesheet type=text/css href=/css/syntax-dark.min.5d9aada6e7d12e754185f88ac16235771e30527e759abbe1080261284c214c0c.css integrity="sha256-XZqtpufRLnVBhfiKwWI1dx4wUn51mrvhCAJhKEwhTAw=" media="screen and (prefers-color-scheme: dark)"><meta name=description content="Righto. This one has given me a mild headache for the last couple of days, but I&amp;rsquo;ve found a workable solution that allows me to set a home page for users in Chrome. You would have thought that would be really easy, right? Well, Google in its infinite wisdom has decided that conventional Windows management is for wusses. So down the rabbit hole we go"><title>Sporiff.dev | Deploying and controlling Google Chrome settings using Microsoft Intune</title><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=%3cnil%3e><link rel=icon type=image/png sizes=16x16 href=%3cnil%3e><link rel=manifest href=/site.webmanifest><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://rootkey.fra1.cdn.digitaloceanspaces.com/images/avatar.webp"><meta name=twitter:title content="Deploying and controlling Google Chrome settings using Microsoft Intune"><meta name=twitter:description content="Righto. This one has given me a mild headache for the last couple of days, but I&rsquo;ve found a workable solution that allows me to set a home page for users in Chrome. You would have thought that would be really easy, right? Well, Google in its infinite wisdom has decided that conventional Windows management is for wusses. So down the rabbit hole we go"></head><header><nav class=secondary><div><a class=nav-link href=/>Home</a>
<a class=nav-link href=/posts>Posts</a>
<a class=nav-link href=/about>About me</a></div></nav></header><body><section id=content><article><h1>Deploying and controlling Google Chrome settings using Microsoft Intune</h1><div><div class=byline><div class=avatar><img src=https://rootkey.fra1.cdn.digitaloceanspaces.com/images/avatar.webp alt="Avatar for Ciarán Ainsworth" width=48px height=48px></div><div class=author>Ciarán Ainsworth</div><time datetime=2018-07-26>Jul 26, 2018</time></div><aside class=tags><a class=tag href=tags/tech>tech</a>
<a class=tag href=tags/microsoft>microsoft</a>
<a class=tag href=tags/azure>azure</a>
<a class=tag href=tags/chrome>chrome</a>
<a class=tag href=tags/intune>intune</a></aside></div><br><br><p>Righto. This one has given me a mild headache for the last couple of days, but I&rsquo;ve found a workable solution that allows me to set a home page for users in Chrome. You would have thought that would be really easy, right? Well, Google in its infinite wisdom has decided that conventional Windows management is for wusses. So down the rabbit hole we go.</p><h2 id=ingesting-admx-templates>Ingesting ADMX templates</h2><p>Let us say, for the sake of argument, that you have deployed the Chrome Enterprise <code>.msi</code> to your devices either during a build or using Intune. Now you want to control some of the settings for your users in order to provide a consistent experience. If you look around online, you&rsquo;ll see various references to ingesting ADMX templates and leveraging these for using with Chrome. This looks something like this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl># Create an OMA-URI to import your ADMX template
</span></span><span class=line><span class=cl>* ./Device/Vendor/MSFT/Policy/ConfigOperations/ADMXInstall/Chrome/Policy/ChromeADMX}
</span></span><span class=line><span class=cl>* Data Type = String
</span></span><span class=line><span class=cl>* Value = the whole body of the Chrome ADMX template
</span></span><span class=line><span class=cl># Leverage policies from within this template using nested OMA-URI settings
</span></span><span class=line><span class=cl>* ./Device/Vendor/MSFT/Policy/Config/Chrome~Policy~googlechrome/ShowHomeButton
</span></span><span class=line><span class=cl>* Data Type = String
</span></span><span class=line><span class=cl>* Value = &lt;enabled/&gt;
</span></span></code></pre></div><p>Pretty simple stuff. This allows us to show the home button. Tickedy boo. So what about setting the home page and landing pages for users? Well, unfortunately, this isn&rsquo;t possible.</p><p>When you use the CSP settings to load and edit the GPO locally, Chrome detects that the computer is not connected to an on-prem AD, and will ignore certain settings including but not limited to your custom home page. Bum gravy. This is mentioned in some capacity in <a href="https://bugs.chromium.org/p/chromium/issues/detail?id=433112">this thread</a> and in <a href=https://www.chromium.org/administrators/policy-list-3#HomepageLocation>this advisory</a>, but it&rsquo;s far from a satisfactory explanation in an Azure AD connected world.</p><h2 id=what-is-a-boy-to-do>What is a boy to do?</h2><p>So here&rsquo;s the dilemma. I know that another way to control Chrome is using a file called <code>master_preferences</code> located in the <code>C:\Program Files (x86)\Google\Chrome\Application</code> folder, so for future deployments it would be entirely possible to simply place this in the image. However, we have nearly 60 devices already out in the world due to the unreal pressure we&rsquo;ve been under to deliver, so I need a remote deployment method.</p><p>First option is to use Powershell. Powershell could easily be pointed at a publicly accessible Azure blob containing the <code>master_preferences</code> file. The problem with this is that Powershell scripts can only be targeted at users, which would mean that in the long run we would not be able to set different preferences on different types of machines.</p><p>So, what about a <code>.msi</code> file? I got this idea in my head to package the file up as an application, which would give us the power not only to deploy per device but also to supersede if we ever want to make changes to the config. The two tools I used to achieve this were <a href=http://nsis.sourceforge.net/Download>NSIS</a> and the free version of <a href=https://www.exemsi.com/download/>exemsi</a>. The steps are as follows:</p><ul><li>Edit your <code>master_preferences</code> file to reflect the changes you want to make</li><li>Place the file in a zip archive</li><li>Run NSIS and select &ldquo;Installer based on ZIP file&rdquo;</li><li>Select your ZIP file, give the installer a suitable name, and set the"Default Folder" value to <code>C:\Program Files (x86)\Google\Chrome\Application</code></li><li>Hit &ldquo;Generate&rdquo; and locate your newly created <code>.exe</code> file</li><li>Next, open up exemsi and click &ldquo;Next&rdquo; to start the wizard</li><li>Select your newly created executable and change the <code>.msi</code> name if desired</li><li>In the installer options, select &ldquo;Per Machine&rdquo; under &ldquo;MSI installation context&rdquo;. This is required to allow you to deploy to devices as opposed to users. If users are your targets, set this to &ldquo;Per User&rdquo;</li><li>Give your application and ID and generate an Upgrade Code. This will allow you to uninstall and supersede if needs be, so keep a note of it and use the same code for any new iterations. Intune will notify you if the codes do not match</li><li>Enter some information about the product including the name, the manufacturer, and the version number</li><li>Optionally, set up contact links</li><li>For install and uninstall arguments, use the flag <code>/S</code> (make sure this is capital). This is the standard NSIS silent install flag</li><li>There is no need to enter any before/after command lines</li><li>Hit &ldquo;Build&rdquo; at the end and it will generate a <code>.msi</code></li></ul><p>After this, upload your <code>.msi</code> to Intune, deploy it to a test group, and watch the magic happen. Please note that you cannot deploy the ADMX template and the <code>master_preferences</code> file at the same time as the two conflict with one another.</p></article></section><footer>Copyright (c) 2022 Ciarán Ainsworth</footer></body></html>