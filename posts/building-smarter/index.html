<!doctype html><html dir=ltr lang=en data-theme><head><title>Ciarán Ainsworth
|
Building smarter</title><meta charset=utf-8><meta name=generator content="Hugo 0.97.3"><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><meta name=description content="
      I write about things for a living


    "><link rel=stylesheet href=/css/main.min.440a169ee4b645c09fe67c6bb076175d3eeac345e8abe5925486ca71a3e5289d.css integrity="sha256-RAoWnuS2RcCf5nxrsHYXXT7qw0Xoq+WSVIbKcaPlKJ0=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/css/markupHighlight.min.058b31f17db60602cc415fd63b0427e7932fbf35c70d8e341a4c39385f5f6f3e.css integrity="sha256-BYsx8X22BgLMQV/WOwQn55MvvzXHDY40Gkw5OF9fbz4=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/css/custom.min.ec0e83e7d616d38ef6d5b475ac380ecf1b0231c475feef0592fe0299f5ccf347.css integrity="sha256-7A6D59YW04721bR1rDgOzxsCMcR1/u8Fkv4CmfXM80c=" crossorigin=anonymous media=screen><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css integrity="sha512-+4zCK9k+qNFUR5X+cKL9EIR+ZOhtIloNl9GIKS57V1MyNsYpYcUrUeQc9vNfzsWfV28IaLL3i96P9sdNyeRssA==" crossorigin=anonymous><link rel="shortcut icon" href=/favicon.ico type=image/x-icon><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=canonical href=/posts/building-smarter/><script type=text/javascript src=/js/anatole-header.min.d0408165d31a17f17bba83038bf54e86121f85021bdf936382e636f0f77a952f.js integrity="sha256-0ECBZdMaF/F7uoMDi/VOhhIfhQIb35NjguY28Pd6lS8=" crossorigin=anonymous></script>
<script type=text/javascript src=/js/anatole-theme-switcher.min.65e936b591bf81484a5ac438c8e4ae6454fb25516d58ce911e4888d7f230bdc5.js integrity="sha256-Zek2tZG/gUhKWsQ4yOSuZFT7JVFtWM6RHkiI1/IwvcU=" crossorigin=anonymous></script><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="/images/Avatar.png"><meta name=twitter:title content="Building smarter"><meta name=twitter:description content="I&rsquo;ve been meaning to improve the way I deploy this website for a little while now. Since I stopped using Netlify in favour of a more bare-bones approach, there has been a lot of manual/ugly work involved with the process of updating this website and posting from its RSS feed to my Mastodon feed.
Initially, I simply cloned the git repository for this site to my FreeBSD box and then SSHd in to the box to pull the lates files."><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","articleSection":"posts","name":"Building smarter","headline":"Building smarter","alternativeHeadline":"","description":"
      
        I\u0026rsquo;ve been meaning to improve the way I deploy this website for a little while now. Since I stopped using Netlify in favour of a more bare-bones approach, there has been a lot of manual\/ugly work involved with the process of updating this website and posting from its RSS feed to my Mastodon feed.\nInitially, I simply cloned the git repository for this site to my FreeBSD box and then SSHd in to the box to pull the lates files.


      


    ","inLanguage":"en-us","isFamilyFriendly":"true","mainEntityOfPage":{"@type":"WebPage","@id":"\/posts\/building-smarter\/"},"author":{"@type":"Person","name":"Ciarán Ainsworth"},"creator":{"@type":"Person","name":"Ciarán Ainsworth"},"accountablePerson":{"@type":"Person","name":"Ciarán Ainsworth"},"copyrightHolder":{"@type":"Person","name":"Ciarán Ainsworth"},"copyrightYear":"2020","dateCreated":"2020-04-19T01:23:40.00Z","datePublished":"2020-04-19T01:23:40.00Z","dateModified":"2020-04-19T01:23:40.00Z","publisher":{"@type":"Organization","name":"Ciarán Ainsworth","url":"","logo":{"@type":"ImageObject","url":"favicon-32x32.png","width":"32","height":"32"}},"image":["/images/Avatar.png"],"url":"\/posts\/building-smarter\/","wordCount":"584","genre":["blog"],"keywords":["git","website","tech","bot","lisp"]}</script></head><body><header><div class="page-top
animated fadeInDown"><a role=button class=navbar-burger data-target=navMenu aria-label=menu aria-expanded=false><span aria-hidden=true></span>
<span aria-hidden=true></span>
<span aria-hidden=true></span></a><nav><ul class=nav__list id=navMenu><div class=nav__links><li><a href=/ title>Home</a></li><li><a href=/about title>About me</a></li><li><a href=/portfolio title>Portfolio</a></li></div><ul><li><a class=theme-switch title="Switch Theme"><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></li></ul></ul></nav></div></header><div class=wrapper><aside><div class="sidebar
animated fadeInDown"><div class=sidebar__content><div class=logo-title><div class=title><img src=/images/Avatar.png alt="profile picture"><h3 title><a href=/>Life inside a computer</a></h3><div class=description><p>I write about things for a living</p></div></div></div><ul class=social-links><li><a href=https://twitter.com/thatdapperbrit rel=me aria-label title><i class="fab fa-twitter fa-2x" aria-hidden=true></i></a></li><li><a href=https://mastodon.technology/@cda rel=me aria-label title><i class="fab fa-mastodon fa-2x" aria-hidden=true></i></a></li><li><a href=mailto:ciaranainsworth@icloud.com rel=me aria-label title><i class="fas fa-envelope fa-2x" aria-hidden=true></i></a></li><li><a href=https://github.com/Sporiff rel=me aria-label title><i class="fab fa-github fa-2x" aria-hidden=true></i></a></li></ul></div><footer class="footer footer--sidebar"><div class=by_farbox><ul class=footer__list><li class=footer__item>&copy;
Ciarán Ainsworth
2022</li></ul></div></footer><script type=text/javascript src=/js/medium-zoom.min.80b0768059c89e2a2180578a3e0e18ede16635e5fedabcccfba6479f60c40bbb.js integrity="sha256-gLB2gFnIniohgFeKPg4Y7eFmNeX+2rzM+6ZHn2DEC7s=" crossorigin=anonymous></script></div></aside><main><div class=autopagerize_page_element><div class=content><div class="post
animated fadeInDown"><div class=post-content><div class=post-title><h1>Building smarter</h1><div class=info><em class="fas fa-calendar-day"></em>
<span class=date>Sun, Apr 19, 2020</span>
<em class="fas fa-stopwatch"></em>
<span class=reading-time>3-minute read</span></div></div><div class=alert><div id=indicator>!</div>Warning: This post is over 365 days old. The information may be out of date.</div><figure><img src=https://rootkey.fra1.cdn.digitaloceanspaces.com/static//images/git.png alt="The git logo"></figure><p>I&rsquo;ve been meaning to improve the way I deploy this website for a little while now. Since I stopped using Netlify in favour of a more bare-bones approach, there has been a lot of manual/ugly work involved with the process of updating this website and posting from its RSS feed to my Mastodon feed.</p><p>Initially, I simply cloned the git repository for this site to my FreeBSD box and then SSHd in to the box to pull the lates files. This, of course, is not very automatic, and it also required me hosting a lot more files in the git repository than strictly necessary since I was performing the <a href=https://github.com/coleslaw-org/coleslaw>coleslaw</a> build on my local machine and pushing this up to replace the directory. This was always highly inefficient, but as usual I kind of just though &ldquo;eh, I&rsquo;ll get round to doing something better later&rdquo;.</p><p>Then we have my bot. I was so pleased with this little thing because it was my first endeavour at writing something in common lisp. However, it too was pretty dumb. In both cases I eventually just ended up setting up cron jobs: one to perform a <code>git pull</code> every 15 minutes and another to run the <code>scbl --load</code> for the bot 5 minutes later. Yuck. Not exactly a dynamic way to do things.</p><p>Since I had a bit of time on my hands today and have also been playing around with <a href=https://sourcehut.org>sourcehut</a>, I figured this was a good a time as any to improve some things. I had two objectives:</p><ul><li>Run the <code>git pull</code> only when a new commit had been pushed</li><li>Immediately run the RSS scraping bot after the repository had been updated so there was no delay</li></ul><p>I knew the former of these was going to be best achieved with a git hook, but since I&rsquo;d never actually used one of these before I really had no idea what I was doing. Luckily, smarter people than myself have <a href=https://gist.github.com/noelboss/3fe13927025b89757f8fb12e9066f2fa>already done this</a> and have been kind enough to write it down.</p><p>tl;dr:</p><ul><li>The server now no longer hosts a working git repository, but instead just hosts a deployment</li><li>A <code>post receive</code> hook picks up the changes and builds the pages on the server (no more pushing a full folder of web pages, hurray!)</li></ul><p>Next, we have my bot. This thing is a pretty simple common lisp web scraper that functions pretty much identically to my <a href=https://github.com/Sporiff/folklorebot-lisp>folklore thursday bot</a>. As I said earlier, this bot was basically just powered by a cron job that tried to <code>sbcl --load</code> the file every 15 minutes or so. This, of course is pretty wasteful for a couple of reasons. Firstly, it&rsquo;s just bad practice to run the thing at intervals when I may not be posting for… months. Secondly, running the REPL rather than just using a binary is pretty expensive. <a href=https://github.com/roswell/roswell>Roswell</a> to the rescue!</p><p>Roswell is a Lisp implementation manager and one of my favourite things ever. In addition to making managing your lisp implementations a breeze, it also allows you to package your lisp scripts pretty trivially. With a few minor changes, I could simply install the bot as a binary and add it to the path of the git_daemon user. Bingo. Now, the <code>post receive</code> hook runs the bot after receiving a new post.</p><p>This has been a fun little exercise. I should probably have got round to this sooner seeing as I&rsquo;ve been in lockdown for a few weeks but unfortunately I&rsquo;m too lazy to be lazy.</p></div><div class=post-footer><div class=info><span class=separator><a class=category href=/categories/blog/>blog</a></span>
<span class=separator><a class=tag href=/tags/git/>git</a><a class=tag href=/tags/website/>website</a><a class=tag href=/tags/tech/>tech</a><a class=tag href=/tags/bot/>bot</a><a class=tag href=/tags/lisp/>lisp</a></span></div></div></div></div></div></main></div><footer class="footer footer--base"><div class=by_farbox><ul class=footer__list><li class=footer__item>&copy;
Ciarán Ainsworth
2022</li></ul></div></footer><script type=text/javascript src=/js/medium-zoom.min.80b0768059c89e2a2180578a3e0e18ede16635e5fedabcccfba6479f60c40bbb.js integrity="sha256-gLB2gFnIniohgFeKPg4Y7eFmNeX+2rzM+6ZHn2DEC7s=" crossorigin=anonymous></script></body></html>